<!DOCTYPE HTML>
<html>
    <head>
        <title>Mass Mobile Hellucination</title>
        <script src="/socket.io/socket.io.js"></script>
        <script src="mmh.js"></script>
        <script src="mousemotioncontrol.js" type="text/javascript"></script>
        <link rel="stylesheet" href="style.css" type="text/css"/>
    </head>
    <body>
        <div id="main" class="fullscreen">
            <h1>The Mass Mobile Hallucination Game.</h1>

            Welcome aboard ! just 2 questions before you can start
            </br>
            </br>

            Your name :
            <input type=text onchange="changeName()" id=username />
            <br/>
            <br/>

            What side fo the room are you seated on ? :
            <input type="radio" name="location" id="playerLocationLeft" onclick="setPlayerLocation('left');" value="Left"> Left
            <input type="radio" name="location" id="playerLocationRight" onclick="setPlayerLocation('right');" value="Right" checked>  Right

            <br/>

            <div id="log"></div>
        </div>

        <div id="color" style="display:none">
            <script type="text/javascript">
                function drawValues() {
                    accel = MMH.getOrientation();
                    document.getElementById("doTiltLR").innerHTML = Math.round(accel.tiltLR);
                }
            </script>
            <div style="background-color: hotpink; height: 100%; width: 100%">COLOR HERE.</div>
        </div>


        <div id="millionaire" style="display:none">
            <!-- <div style="background-color: hotpink; height: 100%; width: 100%">WHO WANTS TO BE A MILLIONAIRE !!</div>
 -->            <div id="millcontainer">
              <div id="millrow">
                <div id="millleft">
                    <input id="millButton" type="button" value=" A " onClick="sendAnswer('A')" />
                </div>
                <div id="millright">
                    <input id="millButton" type="button" value=" B " onClick="sendAnswer('B')"/>
                </div>
              </div>
              <div id="millrow">
                  <div id="left">
                    <input id="millButton" type="button" value=" C " onClick="sendAnswer('C')"/>
                </div>
                <div id="millright">
                    <input id="millButton" type="button" value=" D " onClick="sendAnswer('D')"/>
                </div>
            </div>
            </div>

        <script>
        function sendAnswer(answer){
            //TO DO
            //question number needs to come from the playfield ?
            var payload = { qn: "1", answer: answer,id: socket.socket.sessionid }
            MMH.sendAnswerToServer(payload);
        }
        </script>

        </div>

        <div id="brickout" style="display: none">
            <div style="background-color: lime; height: 100%; width: 100%">
                <h1>The brickout game</h1>Most of these games will actually have the same
                controller. So it won't change anything...</div>
        </div>
        <div id="tilt" style="display: none">
            <div style="background-color: gold; height: 100%; width: 100%;">BASIC TILT SCREEN. Used for a number of games. (should there be a ball
                rolling around) or something else to indicate that we are interested in
                your tilt. Maybe... sometimes mystery is better.
            
                <div id="mousecontroller" style="display:block"> <p>No accelerometer detected use the mouse instead. Click canvas to start
                and stop. Move mouse to rotate arrow.
					<canvas id="mousecanvas" width=200 height=200 style="display:block"></canvas>
					<div id="arrowlog"></div>
				</div>
			</div>
		</div>

        <div id="updownTilt" style="display: none">
            <div style="background-color: #afeeee; height: 100%; width: 100%;">
                For this game its either up or down, add a nice image or animation later
                </br></br></br>
                <div id="updownIndicator" style="font-size:xx-large;"></div>
             </div>
            </div>
        </div>

        <div id="redgreen" style="display: none">
            <div style="background-color: green; height: 100%; width: 50%; float: right"></div>
            <div style="background-color: red; height: 100%; width: 50%; float: left"></div>
        </div>
        <script>
            // What game controllers this file supports. The <div> to show and
            // any initialization function to call to get it going.
            var gameConfig = {}
            gameConfig.worm 	= {section: "redgreen", func: initTilt};
            gameConfig.color 	= {section: "color", func: initColor };
            gameConfig.fairy 	= {section: "tilt", func: initTilt};
            gameConfig.pong 	= {section: "updownTilt", func: initTheNewAndImprovedUpDownOnlyTilt};
            gameConfig.brickout = {section: "redgreen",func: initRedGreen};
            gameConfig.millionaire = {section: "millionaire",func: initMillionaire};

            MMH.performSlowCrappyGyroscopeDetection();

            var socket = io.connect('/players');

            socket.on('changeSettings', function (data) {
                document.getElementById("log").innerHTML = "message from controller " + JSON.stringify(data);
            });

            socket.on('changeGame', function (game) {
                changeGame(game);
            });

            socket.on('userMessage', function (message) {
                //this is fired when the palyfield targets a single user....
                //e.g. for millionaire we need to quit people from the game if they get the wrong answers...
                alert('message from server');
                alert(message);
            });


            // Change the game on request of the controller and initialize the screens and data
            function changeGame(gameName) {
                // Change the screen and call ainitialization routine;
                var section = gameConfig[gameName].section;
                var initFunction = gameConfig[gameName].func;

                // change in the new section content
                document.getElementById("main").innerHTML = document.getElementById(section).innerHTML;

                // call the init function (as specified)
                initFunction();
            }

            function setPlayerLocation(input){

                MMH.setPlayerLocation(input);
            }

            function getPlayerLocation(){
                return MMH.getPlayerLocation();
            }

			// TODO move to MMH.js
            function changeName() {
                socket.emit("namechange", document.getElementById('username').value);
            }

			function updownCallback (accel) {
                if (accel.tiltFB!= undefined)
                {
                   if (accel.tiltFB <0)
                   {
                       document.getElementById("updownIndicator").innerHTML = "UP";
                   }
                    else
                   {
                       document.getElementById("updownIndicator").innerHTML = "DOWN";
                   }
                }
            }

            function movementCallback (accel) {
                mouseArrow.updatePosition(accel.tiltLR, accel.tiltFB);
                mouseArrow.drawArrow();
            }

			
            function initTilt() {
                // start the acceleromters sending
				MMH.init(socket);
				//if (!MMH.clientHasAcceleromters()) {
				//	initmousedetection();
				//}
				mouseArrow = new MouseArrow();
				mouseArrow.init("mousecanvas");
				MMH.listenForMovements(movementCallback);
				
            }

            function initTheNewAndImprovedUpDownOnlyTilt() {
                var side = getPlayerLocation();
                MMH.init(socket);
                MMH.listenForMovements(updownCallback);

            }

            function initColor() {
                // start the acceleromters sending
                MMH.init(socket);
				MMH.listenForMovements();
            }

            function initMillionaire() {
                MMH.init(socket);
               
            }

        //    changeGame("millionaire");

            function initRedGreen() {
                // ask the server what color we are and set the background accordingly.
            }
        </script>
    </body>
</html>