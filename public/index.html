<!DOCTYPE HTML>
<html>
    <head>
        <title>Mass Mobile Hellucination</title>
        <script src="/socket.io/socket.io.js"></script>
        <script src="mmh.js"></script>
        <script src="jquery.min.js"></script>
        <script src="mousemotioncontrol.js" type="text/javascript"></script>
        <link rel="stylesheet" href="style.css" type="text/css"/>
    </head>
    <body>
        <div id="main" class="fullscreen">
            <h1>The Mass Mobile Hallucination Game.</h1>

            Welcome aboard ! just 2 questions before you can start
            </br>
            </br>

            Your name :
            <input type=text onchange="changeName()" id=username />
            <br/>
            <br/>

            What side fo the room are you seated on ? :
            <input type="radio" name="location" id="playerLocationLeft" onclick="setPlayerLocation('left');" value="Left" /> Left
            <input type="radio" name="location" id="playerLocationRight" onclick="setPlayerLocation('right');" value="Right" checked />  Right

            <br/>

            <div id="log"></div>
        </div>

        <script>
            MMH.performSlowCrappyGyroscopeDetection();

            var socket = io.connect('/players');

            socket.on('changeSettings', function (data) {
                handleChangeSettings(data);
            });

            socket.on('changeGame', function (game) {
                changeGame(game);
            });

            socket.on('userMessage', function (message) {
                //this is fired when the palyfield targets a single user....
                //e.g. for millionaire we need to quit people from the game if they get the wrong answers...
                alert('message from server');
                alert(message);
            });


            // Change the game on request of the controller and initialize the screens and data
            function changeGame(gameName) {
                // Change the screen and call ainitialization routine;
                var section = gameConfig[gameName].section;
                var initFunction = gameConfig[gameName].func;

                // change in the new section content
                document.getElementById("main").innerHTML = document.getElementById(section).innerHTML;

                // call the init function (as specified)
                initFunction();
            }

            // TO DO make this generic for now its only the load test that uses this....
            function handleChangeSettings(message){
                if (message.game != undefined && message.game == "loadTest") {

                    changeLoadTestSettings(message);
                }
                else
                {
                    alert("Oops !! I don't know how to process this message !!!" + JSON.stringify(message));
                }
            }

            function setPlayerLocation(input){

                MMH.setPlayerLocation(input);
            }

            function getPlayerLocation(){
                return MMH.getPlayerLocation();
            }

			// TODO move to MMH.js
            function changeName() {
                socket.emit("namechange", document.getElementById('username').value);
            }
            </script>
            <script src="client.js"></script>
    </body>
</html>