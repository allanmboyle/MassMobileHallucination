<!DOCTYPE HTML>
<html>
    
    <head>
        <title>Playfield</title>
        <script src="/socket.io/socket.io.js"></script>
        <script src="/lib/fairy_playfield.js"></script>
        <script src="/lib/worm_playfield.js"></script>
        <script src="/lib/bounce_playfield.js"></script>
        <script src="/lib/millionaire_playfield.js"></script>
        <script src="/lib/animation.js"></script>
        <link rel="stylesheet" href="../style.css" type="text/css" />
    </head>
    
    <body bgcolor="lightblue">
        <h1>Mass Mobile Hallucinegenic Playfield</h1>
        <div id="main">nothing</div>
        <div id="fairy" style="display: none">
            <div style="background-color: grey">Messages per second:
                <span id="stats"></span>
                </br>Time to process a packet:
                <span id="timer">f</span>
            </div>
            <canvas id="playfield" width="900" height="600" bgcolor="gold"></canvas>
            <div style="width: 100%; background-color: pink">THE END</div>
            <div id="log"></div>
            <div id="log2"></div>
        </div>
        <div id="millionaire" style="display: none">
            <div id="millionaireLeft">
            LHS Area
            </div>

            <div id="millionaireRight">
            RHS Area
            </div>

            <div id="millionaireMiddle">
            <br /><br /><br />
            <h4>Question 1???</h4>
            <br /><br /><br />

            Answers go here
            </div>
        </div> 
        <div id=worm style="display: none">
            <div style="width: 100%; height: 100%; background-color: red;">The worms crawl in and the worms crawl out.</div>
            <div id=bounce style="display: none">
                <table align="center" style="width:30%;font-family: Arial, Helvetica, sans-serif; font-size: large">
                    <tr>
                        <td>Score</td>
                        <td>
                            <div id="score">0</div>
                        </td>
                    </tr>
                    <tr>
                        <td>Highest Score</td>
                        <td>
                            <div id="highestScore">0</div>
                        </td>
                    </tr>
                </table>
                <canvas id="bouncecanvas" class="bounce" width="900" height="600"></canvas>
                <table align="center" style="width:80%;font-family: Arial, Helvetica, sans-serif; font-size: medium">
                    <tr>
                        <td>
                            <div id="bouncelog"></div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div id="bouncelog1"></div>
                        </td>
                    </tr>
                </table>
            </div>
            <script>
                var currentGame = null;
                var socket = io.connect("/playfield");

                var gameConfig = {}
                gameConfig.fairy = {
                    section: "fairy",
                    module: FairyPlayfield
                };
                gameConfig.worm = {
                    section: "worm",
                    module: WormPlayfield
                };
                gameConfig.maze = {
                    section: "maze",
                    module: null
                };
                gameConfig.bounce = {
                    section: "bounce",
                    module: BouncePlayfield
                };

                gameConfig.millionaire = {
                    section: "millionaire",
                    module: MillionairePlayfield
                };


                // default starting game
                changeGame("millionaire");

                // Generic playfield functions
                socket.on("changeGame", function (newGame) {
                    changeGame(newGame);
                });

                // Pass these on to the game
                socket.on('updates', function (updates) {
                    currentGame.positionUpdates(updates);
                });
                socket.on('totals', function (totals) {
                    currentGame.totalUpdates(totals);
                });
                socket.on('newuser', function (data) {
                    currentGame.newUser(data);
                });
                socket.on('woosout', function (data) {
                    currentGame.woosOut(data);
                });
                socket.on('players', function (players) {
                    currentGame.initPlayers(players);
                });
                socket.on("admin", function (message) {
                    currentGame.admin(message);
                });

                function changeGame(newGame) {
                    // change the currentGame to new game and shutdown the old one.
                    if (currentGame) currentGame.shutdown();

					if (!gameConfig[newGame]) {
						alert("Game '" + newGame + "' is not supported yet...");
						return;
					}
					
					if (!document.getElementById(gameConfig[newGame].section)) {
						alert("Weird, can't find the game section for " + newGame);
						return;
					}
                    
					document.getElementById("main").innerHTML = document.getElementById(gameConfig[newGame].section).innerHTML;
	                currentGame = gameConfig[newGame].module;
	                
					if (currentGame) { 
						currentGame.init(socket);
					} else {
						alert("Cannot initialize the current game. Maybe its not written yet?");
					}
                }
            </script>
    </body>

</html>