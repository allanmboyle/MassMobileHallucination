<html>

<head>
    <script src="underscore.js"></script>
</head>

<body>
<h1>test  array processing functions</h1>
<input type=button onclick="launchTests()"
       value="Run tests" />
<div id="results"></div>
<script>
    function launchTests() {

        // just add 10,000 items to the array see how long it takes
        userAnswers = null;
        userAnswers = [];
        addItemsToArray(10000);

        //now try to add 10,000 items but this time add or update each item based on the id
        //scenario where user answers the question more than once...
        userAnswers = null;
        userAnswers = [];
        addorUpdateItemsToArray(80000)

        // now lets say we want to figure out the breakdown of answers
        //e.g 20% voted 'A' and 70% voted 'B'
        //this is like ask the audience and also can be used for political worm..
        userAnswers = null;
        userAnswers = [];
        aggregateUserAnswers();

    }

    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function getRandomAnswer() {
        var number = Math.floor(Math.random() * (4 - 1 + 1)) + 1;
        switch (number) {
            case 1:
                return "A";
                break;

            case 2:
                return "B";
                break;

            case 3:
                return "C";
                break;
            default:
                return "D";
                break;
        }
    }


    function aggregateUserAnswers()
    {
        //lets get an array with 1000 random users answers
        addorUpdateItemsToArray(1000) ;
        var totals =  calcStatistics();

        var text = "A :" + totals.A + " B : "   + totals.B  + " C : "   + totals.C  + " D : "   + totals.D;
        document.getElementById("results").innerHTML += text + " </br>";
    }



    function addItemsToArray(count) {

        var time1 = new Date().getTime();
        for (i = 0; i < count; i++) {
            var payload = {
                qn: "1",
                answer: getRandomAnswer(),
                id: getRandomInt(1, 400)
            };
            AddUserAnswer(payload);
        }

        var time2 = new Date().getTime();
        var difference_ms = time2 - time1;
        var message = "addItemsToArray  time : " + difference_ms + "no items : " + userAnswers.length;
        document.getElementById("results").innerHTML += message + " </br>";
    }

    function addorUpdateItemsToArray(count) {

        var time1 = new Date().getTime();
        for (i = 0; i < count; i++) {
            var payload = {
                qn: "1",
                answer: getRandomAnswer(),
                id: getRandomInt(1, 1000)
            };
            AddUpdateUserAnswer(payload);
        }

        var time2 = new Date().getTime();
        var difference_ms = time2 - time1;
        var message = "addorUpdateItemsToArray  time : " + difference_ms + "no items : " + userAnswers.length;
        document.getElementById("results").innerHTML += message + " </br>";
    }

    function AddUserAnswer(userAnswer) {
        userAnswers.push({
            qn: userAnswer.qn,
            answer: userAnswer.answer,
            id: userAnswer.id
        })
    }


    function calcStatistics(item)
    {
        var totals = {A:0,B:0,C:0,D:0};

        var fee=  _.reduce(userAnswers,function(result,item){

            switch (item.answer) {
                case "A":
                    result.A++;
                    break;
                case "B":
                    result.B++;
                    break;
                case "C":
                    result.C++;
                    break;
                case "D":
                    result.D++;
                    break;
                default:
                    break;
            }
             return result;
            },totals)   ;

          return fee;
    }



    function AddUpdateUserAnswer(userAnswer) {
        var id = userAnswer.id;
        for (var i = 0; i < userAnswers.length; i++) {
            if (userAnswers[i].id == id) {
                userAnswers.splice(i, 1);
                break;
            }
        }
        AddUserAnswer(userAnswer);
    }

    var userAnswers = [];
</script>
</body>

</html>