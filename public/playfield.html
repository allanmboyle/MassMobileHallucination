<html>
<head>
	<title>Playfield</title>
	<script src="/socket.io/socket.io.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
	<script src="/lib/fairy_playfield.js"></script>
	<script src="/lib/worm_playfield.js"></script>
    <script src="/lib/bounce_playfield.js"></script>
	<script src="/lib/animation.js"></script>
	<link rel="stylesheet" href="../style.css" type="text/css"/>
</head>

<body bgcolor="lightblue">
	<h1> Mass Mobile Hallucinegenic Playfield <h1>

	<div id=main> nothing </div>

	<section id=fairy style="display: none">
		<div style="background-color: grey">
			Messages per second: <span id="stats"></span></br>
			Time to process a packet: <span id="timer">f</span>
		</div>
		<canvas id="playfield" width="900" height="600" bgcolor="gold"></canvas>
		<div style="width: 100%; background-color: pink">THE END</div>
		<div id="log"></div>
		<div id="log2"></div>
	</div>
	<div id=worm style="display: none">
		<div style="width: 100%; height: 100%; background-color: red;">
		The worms crawl in and the worms crawl out.
	</div>
	
	<div id=bounce style="display: none">
		<div style="background-color: grey">
			Debug Messages go here: <span id="stats"></span></br>
		</div>
		<div  id="score1">Score :</div><div id="score">0</div><br>
    	<div  id="hscore1">Highest Score  :</div><div  id="highestScore">0</div><br>
		<canvas id="bouncecanvas" class="bounce" width="900" height="600"></canvas>
		 <div style="width: 100%; background-color: pink">THE END</div>
		<div id="bouncelog"></div>
		<div id="bouncelog1"></div>
	</div>

	<script>
		var currentGame = null;
		var socket = io.connect("/playfield");

		var gameConfig = {}
		gameConfig.fairy = {section: "fairy", module: FairyPlayfield};
		gameConfig.worm =  {section: "worm", module: WormPlayfield};
		gameConfig.maze =  {section: "maze", module: null};
		gameConfig.bounce =  {section: "bounce", module: BouncePlayfield};


		// default starting game
	//	changeGame("fairy");
		changeGame("bounce");


		// Generic playfield functions
		socket.on("changeGame", function (newGame) { changeGame(newGame); });
		
		// Pass these on to the game
		socket.on('updates', function (updates) { currentGame.processPositionUpdates(updates); });
		socket.on('totals', function (totals) { currentGame.processTotalUpdates(totals); });
        socket.on('newuser', function (data) 	{ currentGame.newUser(data); });
        socket.on('woosout', function (data) 	{ currentGame.woosOut(data); });
		socket.on('players', function (players) { currentGame.initPlayers(players);	});
		socket.on("admin", function (message) 	{ currentGame.admin(message); });

		//socket.on('namechange', function (data) { nameChange(data); });
		
		function changeGame(newGame) {
			// change the currentGame to new game and shutdown the old one.
			if (currentGame) currentGame.shutdown();
			document.getElementById("main").innerHTML = document.getElementById(gameConfig[newGame].section).innerHTML;
			currentGame = gameConfig[newGame].module;
			if (currentGame) currentGame.init(socket);
		}
    </script>
</body>
</html>
