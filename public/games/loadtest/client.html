<div id="loadTestStatus">Not started  just waiting to fhe call to arms from the controller!</div>
<br/>
number of connections <div id="loadTestConnections">0</div>
<br/>
 <div id="loadtestControllerMessages"></div>
<br/>
<script>
	var SEND_FREQUENCY = 100;

    var loadTestPlayers = [];
    var loadTestHasBegun = false;

    var timer = null;

    var sendLoadDataTimer;

    function initClient(){

        // do nothing here really , just wait till the controller flicks through
        // a message to start

    }

	function stopClient() {
		clearInterval(sendLoadDataTimer);
	}

    //kick off the load test or change the existing test run
    function changeLoadTestSettings(message){
        var rampUpCount = message.rampUpConnections;
        var frequency = message.clientSendFrequency;


        SEND_FREQUENCY = frequency;

        outputMessage("ramp up users by" + rampUpCount);
        addLoadTestUsers(rampUpCount);
        if (!loadTestHasBegun)
        {
            document.getElementById("loadTestStatus").innerHTML = "Start load testing!";

            sendLoadTestData();
            loadTestHasBegun = true;
        }
    }

    ///ramp up more users
    function addLoadTestUsers(count)
    {
        for (i = 0; i < count; i++) {

            var player = {};
            player.socket = io.connect('/players', {'force new connection': true});
            player.socket.emit("namechange", "Loren Carpenter " + Math.floor(Math.random()*9999));
            loadTestPlayers.push(player);
        }
        document.getElementById("loadTestConnections").innerHTML = loadTestPlayers.length;

    }

    //start pumping out random accelerometer data to the server
    function sendLoadTestData()
    {
        for (p in loadTestPlayers) {
            // move them both up and down
            accel = {
                tiltLR: Math.random()*180-90,
                tiltFB: Math.random()*180-90,
                dir: Math.random()*180,
                motionUD: Math.random()*90,
                playerLocation : "left"
            }
            loadTestPlayers[p].socket.emit("accel", accel);
        }

        //remove each time in case the send frequency has changed
        if (timer !=undefined)
        {
            clearTimeout(timer);
        }
        timer= setTimeout(sendLoadTestData, SEND_FREQUENCY);
    }

    function outputMessage(message){
        var content  =  document.getElementById("loadtestControllerMessages").innerHTML;

        content += "<br/>";
        content +=message;
        document.getElementById("loadtestControllerMessages").innerHTML = content;

    }

    //New config settings from controller...
    function updateGameSettings(message){
        if (message.game != undefined && message.game == "loadTest") {

            changeLoadTestSettings(message);
        }
        else
        {
            alert("Oops !! I don't know how to process this message !!!" + JSON.stringify(message));
        }
    }
</script>