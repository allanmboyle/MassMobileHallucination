<style>
	.hideme { display: none; }
	.wormsplash {
		font-size: 40pt;
		font-weight: 400;
		font-family: inherit;
		text-align: center;
		background-color: gold;
		width: 100%;
		height: 100%;
	}
	.wormworm {
		width: 100%; height: 95%; 
		margin: 0px;
		padding: 0px;
		overflow: hidden;
	}
	.rounded-corners {
    	 -moz-border-radius: 20px;
    	-webkit-border-radius: 20px;
    	-khtml-border-radius: 20px;
    	border-radius: 20px;
	}
</style>

<div class="wormsplash rounded-corners">
	THE GREAT DEBATE
</div>

<canvas class="wormworm hideme" id="wormcanvas" ></canvas>

<script src="/games/worm/worm_playfield.js"></script>
<script>
	var GOOD = "ROCKS!";
	var BAD = "SUX!";

	var WIGGLE_INTERVAL = 500;		// draw a worm dot every half a second
	var TOTAL_WORM_TIME = 120000;	// total time represented on the chart, 2 minutes.

	function initPlayfield() {
		WormPlayfield.init();

		// show the debate splash, fade, then show the worm.
		setTimeout(function () {
			$(".wormsplash").fadeOut(2000, function() {
				$(".wormsplash").addClass("hideme");
				$(".wormworm").fadeIn(3000);
				$(".wormworm").removeClass("hideme");
				startWorming();
			})	
		}, 1000); //8000

		return WormPlayfield;
	}

	function shutdown() {
		// stop worming
		clearInterval(wormInerval);
	}

	var canvas;
	var ctx;
	function startWorming() {
		canvas = document.getElementById("wormcanvas");
 		ctx = canvas.getContext("2d");

		// set the initial worm position to the middle of the canvas. 
 		lastWormY = canvas.height/2;

		drawWormBackground();

		// launch an interval thread		
		wormInternal = setInterval(drawNextWiggle, WIGGLE_INTERVAL);
	}

	var lastWormX = 0;
	var lastWormY = 0; // canvas.height/2;

	// Draw the next point along the worm.
	function drawNextWiggle() {
		// alert("average: " + WormPlayfield.averageWorm());

		var nextWormX = lastWormX + Math.floor(WIGGLE_INTERVAL/TOTAL_WORM_TIME*canvas.width); 
		var nextWormY = Math.floor(((WormPlayfield.averageWorm() + 90)/180)*canvas.height);

		// alert("wiggle " + lastWormX + ", " + lastWormY + " to " + nextWormX + "," + nextWormY);

		// draw the line
		ctx.lineWidth = 2;
       	ctx.beginPath();
       	ctx.moveTo(lastWormX, lastWormY);
       	ctx.lineTo(nextWormX, nextWormY);
       	ctx.stroke();

		// reset the last positions
		lastWormX = nextWormX;
		lastWormY = nextWormY;

		if (lastWormX > canvas.width) {
			clearInterval(wormInterval);
			alert("The Debate is Over!");
		}
	}

	function drawWormBackground() {
		ctx.canvas.width  = window.innerWidth;
  		ctx.canvas.height = window.innerHeight;

		ctx.fillStyle = "rgb(200,90,90)";
		ctx.fillRect (0, 0, canvas.width, canvas.height/2);
		 
		ctx.fillStyle = "rgba(90, 90, 200, 0.5)";
		ctx.fillRect (0, canvas.height/2, canvas.width, canvas.height);

		ctx.fillStyle = "rgb(10,10,10)";
		ctx.fillRect (0, canvas.height/2-2, canvas.width, 3);

		ctx.fillStyle = "blue";
  		ctx.font = "bold 36pt Arial";
  		ctx.fillText(GOOD, canvas.width - canvas.width/5, canvas.height/10);
  		ctx.fillText(BAD, canvas.width - canvas.width/5, canvas.height - canvas.height/16 );
	}
</script>